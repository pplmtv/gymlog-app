(function(){"use strict";var e={272:function(e,t,s){var o=s(144),r=s(32),a=(s(24),function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)}),n=[],i=s(1),l={},c=(0,i.Z)(l,a,n,!1,null,null,null),u=c.exports,m=s(345),g=s(629),p=s(669),d=s.n(p);const f=d().create({baseURL:"http://127.0.0.1:8000/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});f.interceptors.request.use((e=>{console.log("message clear."),console.log("process.env.VUE_APP_ROOT_API","http://127.0.0.1:8000/api/v1/"),_.dispatch("message/clearMessages");const t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(e=>Promise.reject(e))),f.interceptors.response.use((e=>(console.log("DEBUG api.interceptors.response.use"),console.log("status:",e.status),e)),(e=>{console.log("error.response=",e.response);const t=e.response?e.response.status:500;let s;if(400===t){const t=[].concat.apply([],Object.values(e.response.data));_.dispatch("message/setWarningMessages",{messages:t})}else if(401===t){const e=localStorage.getItem("access");s=null!=e?"ログイン有効期限切れ":"認証エラー",_.dispatch("auth/logout"),_.dispatch("message/setErrorMessage",{message:s})}else 403===t?(s="権限エラーです。",_.dispatch("message/setErrorMessage",{message:s})):(s="想定外のエラーです",_.dispatch("message/setErrorMessage",{message:s}));return Promise.reject(e)}));var h=f;o["default"].use(g.ZP);const v={namespaced:!0,state:{username:"",isLoggedIn:!1},mutations:{set(e,t){e.username=t.user.username,e.isLoggedIn=!0},clear(e){e.username="",e.isLoggedIn=!1}},actions:{login(e,t){return h.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((t=>(localStorage.setItem("access",t.data.access),e.dispatch("renew"))))},logout(e){localStorage.removeItem("access"),e.commit("clear")},renew(e){return h.get("/auth/users/me/").then((t=>{const s=t.data;e.commit("set",{user:s})}))}}},b={namespaced:!0,state:{error:"",warnings:[],info:""},mutations:{set(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear(e){e.error="",e.warnings=[],e.info=""}},actions:{setErrorMessage(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningsMessage(e,t){e.commit("clear"),e.commit("set",{warnings:t.messages})},setInfoMessage(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessages(e){e.commit("clear")}}},w=new g.ZP.Store({modules:{auth:v,message:b}});var _=w,y=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"home-page"}},[t("GlobalHeader"),t("GlobalMessage"),t("main",{staticClass:"container mt-5 p-5"},[t("p",{staticClass:"h5 mb-5"},[e._v("ホーム")]),t("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitSave.apply(null,arguments)}}},[t("div",{staticClass:"row form-group"},[t("label",{staticClass:"col-sm-3 col-form-label"},[e._v("タイトル")]),t("div",{staticClass:"col-sm-8"},[t("b-input",{staticClass:"form-control",attrs:{type:"text"},model:{value:e.form.book.title,callback:function(t){e.$set(e.form.book,"title",t)},expression:"form.book.title"}})],1)]),t("div",{staticClass:"row form-group"},[t("label",{staticClass:"col-sm-3 col-form-label"},[e._v("価格")]),t("div",{staticClass:"col-sm-8"},[t("b-input",{staticClass:"form-control",attrs:{type:"text"},model:{value:e.form.book.price,callback:function(t){e.$set(e.form.book,"price",t)},expression:"form.book.price"}})],1)]),t("div",{staticClass:"row text-center mt-5"},[t("div",{staticClass:"col-sm-12"},[t("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v(" "+e._s(e.isCreated?"更新":"登録")+" ")])],1)])])],1)],1)},k=[],C=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"header"}},[t("b-navbar",{attrs:{type:"dark",variant:"dark"}},[t("a",{staticClass:"navbar-brand",attrs:{href:"/"}},[e._v("gymlog+")]),e.$route.meta.requiresAuth?t("b-navbar-nav",{staticClass:"ml-auto"},[e.isLoggedIn?t("b-nav-item-dropdown",{attrs:{right:""},scopedSlots:e._u([{key:"button-content",fn:function(){return[e._v(e._s(e.username))]},proxy:!0}],null,!1,1662484308)},[t("b-dropdown-item",{attrs:{href:"#"},on:{click:e.clickLogout}},[e._v(" ログアウト ")])],1):t("b-nav-item",{attrs:{href:"# v-on:click=clickLogin"}},[e._v(" ログイン ")])],1):e._e()],1)],1)},x=[],M={computed:{username:function(){return this.$store.state.auth.username},isLoggedIn:function(){return this.$store.state.auth.isLoggedIn}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}},$=M,I=(0,i.Z)($,C,x,!1,null,null,null),L=I.exports,S=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"messages"}},[t("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[e._v(" "+e._s(e.message.error)+" ")]),t("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.warnings.length,expression:"message.warnings.length"}],attrs:{variant:"warning",show:""}},[e._v(' 0" class="mb-0" > '),e._l(e.message.warnings,(function(s){return t("p",{key:s,staticClass:"mb-0"},[e._v(" "+e._s(s)+" ")])}))],2),t("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[e._v(" "+e._s(e.message.info)+" ")])],1)},G=[],O={computed:{message:function(){return this.$store.state.message}}},E=O,j=(0,i.Z)(E,S,G,!1,null,null,null),P=j.exports,T={components:{GlobalHeader:L,GlobalMessage:P},data(){return{form:{book:{title:"",price:0}}}},computed:{isCreated:function(){return void 0!==this.form.book.id}},methods:{submitSave:function(){console.log("create or update."),console.log("DEBUG START."),d().get("http://127.0.0.1:8000/api/v1/books/").then((e=>{console.log("DEBUG axios get success."),console.log("status:",e.status)})).catch((e=>{console.log("axiosGetErr",e)})),d().post("http://127.0.0.1:8000/api/v1/books/",{title:"urasima tarou",price:2e3,created_at:"2021-12-07T06:41:56.325618+09:00"}).then((e=>{console.log("DEBUG axios post success."),console.log("status:",e.status)})).catch((e=>{console.log("axiosGetErr",e)})).finally((()=>{console.log("DEBUG END.")})),h({method:this.isCreated?"put":"post",url:this.isCreated?"/books/"+this.form.book.id+"/":"/books/",data:{id:this.form.book.id,title:this.form.book.title,price:this.form.book.price}}).then((e=>{const t=this.isCreated?"更新しました。":"登録しました。";this.$store.dispatch("message/setInfoMessage",{message:t}),this.form.book=e.data}))}}},q=T,Z=(0,i.Z)(q,y,k,!1,null,null,null),U=Z.exports,A=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"login-page"}},[t("GlobalHeader"),t("GlobalMessage"),t("main",{staticClass:"container mt-5 p-5"},[t("p",{staticClass:"h5 mb-5"},[e._v("ログイン")]),t("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitLogin.apply(null,arguments)}}},[t("div",{staticClass:"row form-group"},[t("label",{staticClass:"col-sm-3 col-form-label"},[e._v("ユーザー名")]),t("div",{staticClass:"col-sm-8"},[t("b-input",{attrs:{type:"text",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)]),t("div",{staticClass:"row form-group"},[t("label",{staticClass:"col-sm-3 col-form-label"},[e._v("パスワード")]),t("div",{staticClass:"col-sm-8"},[t("b-input",{attrs:{type:"password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)]),t("div",{staticClass:"row text-center mt-5"},[t("div",{staticClass:"col-sm-12"},[t("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("ログイン")])],1)])])],1)],1)},D=[],B={components:{GlobalHeader:L,GlobalMessage:P},data(){return{form:{username:"",password:""}}},methods:{submitLogin:function(){console.log("Login execute."),this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password}).then((()=>{console.log("Login succeeded."),this.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});const e=this.$route.query.next||"/";this.$router.replace(e)}))}}},H=B,R=(0,i.Z)(H,A,D,!1,null,null,null),N=R.exports;o["default"].use(m.Z);const W=[{path:"/",component:U,meta:{requiresAuth:!0}},{path:"/login",component:N},{path:"/:cacheAll(.*)",redirect:"/"}],F=new m.Z({mode:"history",routes:W});function X(e){console.log("Force to login page."),F.replace({path:"/login",query:{next:e.fullPath}})}F.beforeEach(((e,t,s)=>{const o=_.state.auth.isLoggedIn,r=localStorage.getItem("access"),a=e.matched.some((e=>e.meta.requiresAuth));console.log("isLoggedIn=",o),a?o?(console.log("User is already logged in. So, free to next."),s()):(console.log("User is not logged in."),null!=r?(console.log("Try to renew user info"),_.dispatch("auth/renew").then((()=>{console.log("Succeeded to renew. So, free to next."),s()})).catch((()=>{X(e)}))):X(e)):(console.log("Go to public page."),s())}));var z=F;o["default"].config.productionTip=!1,o["default"].use(r.ZPm),new o["default"]({router:z,store:_,render:e=>e(u)}).$mount("#app")}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,o,r,a){if(!o){var n=1/0;for(u=0;u<e.length;u++){o=e[u][0],r=e[u][1],a=e[u][2];for(var i=!0,l=0;l<o.length;l++)(!1&a||n>=a)&&Object.keys(s.O).every((function(e){return s.O[e](o[l])}))?o.splice(l--,1):(i=!1,a<n&&(n=a));if(i){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,r,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={826:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,a,n=o[0],i=o[1],l=o[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(r in i)s.o(i,r)&&(s.m[r]=i[r]);if(l)var u=l(s)}for(t&&t(o);c<n.length;c++)a=n[c],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(272)}));o=s.O(o)})();
//# sourceMappingURL=index.6cf81022.js.map